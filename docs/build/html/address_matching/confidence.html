
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Step 5: Match Confidence Calculation &#8212; NBL-CNB 0.1 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=796348d33e8b1d947c94" rel="stylesheet">
<link href="../_static/styles/bootstrap.css?digest=796348d33e8b1d947c94" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=796348d33e8b1d947c94" rel="stylesheet">

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=796348d33e8b1d947c94" rel="stylesheet">
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2">
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2">
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=796348d33e8b1d947c94">
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=796348d33e8b1d947c94">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'address_matching/confidence';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Polygon Splitting" href="../polygon_cutting.html" />
    <link rel="prev" title="Step 4: Match QA/QC" href="qa_qc.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="docsearch:language" content="en">
  </head>
  
  
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="180" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>

  
  <input type="checkbox" class="sidebar-toggle" name="__primary" id="__primary">
  <label class="overlay overlay-primary" for="__primary"></label>

  
  <input type="checkbox" class="sidebar-toggle" name="__secondary" id="__secondary">
  <label class="overlay overlay-secondary" for="__secondary"></label>

  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
      
<form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
    </div>
  </div>

  
  <nav class="bd-header navbar navbar-expand-lg bd-navbar" id="navbar-main"><div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
      <span class="fa-solid fa-bars"></span>
  </label>
  <div id="navbar-start">
    
    
  


<a class="navbar-brand logo" href="../index.html">

  
  
  
  
  
  
  

  
  
    <p class="title logo__title">NBL-CNB 0.1 documentation</p>
  
</a>
    
  </div>

  
  <div class="col-lg-9 navbar-header-items">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <nav class="navbar-nav">
    <p class="sidebar-header-items__title" role="heading" aria-level="1" aria-label="Site Navigation">
        Site Navigation
    </p>
    <ul id="navbar-main-elements" class="navbar-nav">
        
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../project_overview.html">
                        Project Overview
                      </a>
                    </li>
                

                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="../address_matching_process.html">
                        Address Matching Process
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../polygon_cutting.html">
                        Polygon Splitting
                      </a>
                    </li>
                
    </ul>
</nav>
      </div>
      
    </div>

    <div id="navbar-end">
      
        <div class="navbar-end-item navbar-persistent--container">
          
<button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-toggle="tooltip">
  <i class="fa-solid fa-magnifying-glass"></i>
</button>
        </div>
      
      
      <div class="navbar-end-item">
        <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
</button>
      </div>
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          <a href="https://github.com/StatCan/NBL-CNB" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-toggle="tooltip"><span><i class="fab fa-github"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
      </ul>
      </div>
      
    </div>
  </div>


  
  
    <div class="navbar-persistent--mobile">
<button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-toggle="tooltip">
  <i class="fa-solid fa-magnifying-glass"></i>
</button>
    </div>
  

  
  <label class="sidebar-toggle secondary-toggle" for="__secondary">
      <span class="fa-solid fa-outdent"></span>
  </label>
  

</div>
  </nav>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        
  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
      
      <div class="navbar-center-item">
        <nav class="navbar-nav">
    <p class="sidebar-header-items__title" role="heading" aria-level="1" aria-label="Site Navigation">
        Site Navigation
    </p>
    <ul id="navbar-main-elements" class="navbar-nav">
        
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../project_overview.html">
                        Project Overview
                      </a>
                    </li>
                

                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="../address_matching_process.html">
                        Address Matching Process
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../polygon_cutting.html">
                        Polygon Splitting
                      </a>
                    </li>
                
    </ul>
</nav>
      </div>
      
      </div>
    

    
    
    <div class="sidebar-header-items__end">
      
      <div class="navbar-end-item">
        <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
</button>
      </div>
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          <a href="https://github.com/StatCan/NBL-CNB" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-toggle="tooltip"><span><i class="fab fa-github"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
      </ul>
      </div>
      
    </div>
    
  </div>

  
  <div class="sidebar-start-items sidebar-primary__section">
    <div class="sidebar-start-items__item"><nav class="bd-links" id="bd-docs-nav" aria-label="Section navigation">
  <p class="bd-links__title" role="heading" aria-level="1">
    Section Navigation
  </p>
  <div class="bd-toc-item navbar-nav">
    <ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="run_process.html">Run Process</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul class="simple">
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="data_prep.html">Data Preparation</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="parcel_rel_cal.html">Parcel Relationship Calculation</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul class="simple">
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="matching.html">Matching</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul class="simple">
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="qa_qc.html">QA/QC</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul class="simple">
</ul>
</li>
<li class="toctree-l1 current active has-children"><a class="current reference internal" href="#">Confidence Calculation</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-5"><i class="fa-solid fa-chevron-down"></i></label><ul class="simple">
</ul>
</li>
</ul>

  </div>
</nav>
    </div>
  </div>
  

  
  <div class="sidebar-end-items sidebar-primary__section">
    <div class="sidebar-end-items__item">
    </div>
  </div>

  
  <div id="rtd-footer-container"></div>

      </div>
      <main id="main-content" class="bd-main">
        
        
        <div class="bd-content">
          <div class="bd-article-container">
            
            <div class="bd-header-article">
                
            </div>
            
            
            <article class="bd-article" role="main">
              
  <section id="step-5-match-confidence-calculation">
<h1>Step 5: Match Confidence Calculation<a class="headerlink" href="#step-5-match-confidence-calculation" title="Permalink to this heading">#</a></h1>
<div class="toctree-wrapper compound">
</div>
<p>For reference the descriptions on this page cover the code in <strong>match_confidence_calc.py</strong></p>
<p>The final step of the matching process is the confidence calculation. Confidence is a numeric score
calculated based off the characteristics of the match. Additionally, secondary sources such as the
National Address Register (NAR) are brought in to add to the calculation wherever possible. It is
important to note that the confidence score is an arbitrary number and should not be considered an
indicator percent confidence.</p>
<p>As the number of available sources can vary wildly depending on the region of work the below score
breakdown should be considered an example and the number of sources included in the initial score
caculation will vary from region to region.</p>
<section id="base-scores">
<h2>Base Scores<a class="headerlink" href="#base-scores" title="Permalink to this heading">#</a></h2>
<p>The base score is the initial value assigned to a match based on the relationship
between the number of address points and the number of building polygons in the
linked parcel (if available). This score is based off the complexity of the relationship,
or lack of relationship in cases where there is no linked parcel.</p>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Relationship Type</p></th>
<th class="head"><p>Base Score</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>One to One</p></td>
<td><p>60</p></td>
</tr>
<tr class="row-odd"><td><p>One to Many</p></td>
<td><p>55</p></td>
</tr>
<tr class="row-even"><td><p>Many to One</p></td>
<td><p>50</p></td>
</tr>
<tr class="row-odd"><td><p>Many to Many</p></td>
<td><p>40</p></td>
</tr>
<tr class="row-even"><td><p>Unlinked</p></td>
<td><p>30</p></td>
</tr>
<tr class="row-odd"><td><p>Manual</p></td>
<td><p>100</p></td>
</tr>
<tr class="row-even"><td><p>Other</p></td>
<td><p>0</p></td>
</tr>
</tbody>
</table>
</section>
<section id="match-method">
<h2>Match Method<a class="headerlink" href="#match-method" title="Permalink to this heading">#</a></h2>
<p>The method used to make the match is also taken into account as seen in the table
below.</p>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Method Type</p></th>
<th class="head"><p>Score Modifier</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Intersect</p></td>
<td><p>7</p></td>
</tr>
<tr class="row-odd"><td><p>Data Linking</p></td>
<td><p>3</p></td>
</tr>
<tr class="row-even"><td><p>20m Buffer</p></td>
<td><p>0</p></td>
</tr>
<tr class="row-odd"><td><p>20m Buffer BP</p></td>
<td><p>0</p></td>
</tr>
</tbody>
</table>
<p><strong>20m_bp</strong> only applies to linkages that fall within the big parcel matching method.</p>
</section>
<section id="link-distance">
<h2>Link Distance<a class="headerlink" href="#link-distance" title="Permalink to this heading">#</a></h2>
<p>Link distance is a key indicator on the accuracy of a match. The shorter the distance
between the address point and the building footprint</p>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Link Distance</p></th>
<th class="head"><p>Score Modifier</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>5m&gt;</p></td>
<td><p>10</p></td>
</tr>
<tr class="row-odd"><td><p>5m-20m</p></td>
<td><p>5</p></td>
</tr>
<tr class="row-even"><td><p>20m-50m</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-odd"><td><p>50m-200m</p></td>
<td><p>0</p></td>
</tr>
<tr class="row-even"><td><p>200m-450m</p></td>
<td><p>-10</p></td>
</tr>
</tbody>
</table>
</section>
<section id="other-secondary-sources">
<h2>Other Secondary Sources<a class="headerlink" href="#other-secondary-sources" title="Permalink to this heading">#</a></h2>
<p>Secondary sources from both internal and external data providers are also incorporated
into the confidence score.</p>
<p>Internal data sources such as the National Address Register (NAR) and the Statistical Building Register (SBgR)
are utilized.</p>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Internal Data Linkage</p></th>
<th class="head"><p>Score Modifier</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>NAR Link</p></td>
<td><p>10</p></td>
</tr>
<tr class="row-odd"><td><p>SBgR Link</p></td>
<td><p>5</p></td>
</tr>
</tbody>
</table>
<p>Wherever possible authoritative external sources are used to validate the match. Some examples
of a secondary source include: a civic address point layer from a city within the AOI, or an address
field in the parcel data used to make the matches.</p>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Secondary Sources</p></th>
<th class="head"><p>Score Modifier</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Municipal Civic Link</p></td>
<td><p>5</p></td>
</tr>
<tr class="row-odd"><td><p>Parcel Address Match</p></td>
<td><p>5</p></td>
</tr>
</tbody>
</table>
</section>
<section id="final-classification">
<h2>Final Classification<a class="headerlink" href="#final-classification" title="Permalink to this heading">#</a></h2>
<p>Once all available confidence modifiers are added to the score the value is then classified into comfidence types.
These classifications and the scores required to attain them can be seen below:</p>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Confidence Type</p></th>
<th class="head"><p>Rule</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>LOW</p></td>
<td><p>&lt;60</p></td>
</tr>
<tr class="row-odd"><td><p>MEDIUM</p></td>
<td><p>&gt;=60 and &lt;70</p></td>
</tr>
<tr class="row-even"><td><p>HIGH</p></td>
<td><p>&gt;=70</p></td>
</tr>
</tbody>
</table>
</section>
<section id="method">
<h2>Method<a class="headerlink" href="#method" title="Permalink to this heading">#</a></h2>
<p>The information described above is put into use in the following way:</p>
<ol class="arabic simple">
<li><p>In cases are checking the address data against a secondary source (NAR, municipal level civic address sources) a True/False flag system is used to
indicate whether or not the address associated with the address point appear in that secondary source. Then during the main confidence calculation the
score is changed based on whether the value returned was True or False.</p></li>
<li><p>In cases where we are classifying a value into a cateogry (link distance, etc) the value in question is compared against the table and the
appropriate value is added or subtracted from the score as needed.</p></li>
<li><p>The total score is then classified into a confidence type LOW, MEDIUM, or HIGH based on the result of the score calculation.</p></li>
<li><p>The results are then then added to the line link values from the qa/qc step for easier visualization.</p></li>
<li><p>All results are exported to the project geopackage.</p></li>
</ol>
<p>The code for the above process:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">civics_flag_builder</span><span class="p">(</span><span class="n">civic_num</span><span class="p">,</span> <span class="n">str_nme</span><span class="p">,</span> <span class="n">str_type</span><span class="p">,</span> <span class="n">mun_civics</span><span class="p">,</span> <span class="n">civics_number_field</span><span class="o">=</span><span class="s1">&#39;civic_num&#39;</span><span class="p">,</span> <span class="n">civics_sname_field</span><span class="o">=</span><span class="s1">&#39;st_nme&#39;</span><span class="p">,</span> <span class="n">civics_stype_field</span><span class="o">=</span><span class="s1">&#39;st_type&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Creates the confidence flags for a match and returns the following output:</span>

<span class="sd">    1: Address value matches a civic address that fall in same parcel</span>
<span class="sd">    0: Address value does not match civic that fall in same parcel</span>
<span class="sd">    -1: No civic value in parcel or no underlying parcel to compare</span>

<span class="sd">    Inputs should be prefiltered to only the records associated with the adp and parcel in question</span>
<span class="sd">    str_type is currently unused but can be added in in the future</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1"># if no municipal civics are present return -1</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mun_civics</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>

    <span class="n">check_address</span> <span class="o">=</span> <span class="n">mun_civics</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">mun_civics</span><span class="p">[</span><span class="n">civics_number_field</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="n">civic_num</span><span class="p">))</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">mun_civics</span><span class="p">[</span><span class="n">civics_sname_field</span><span class="p">]</span> <span class="o">==</span> <span class="n">str_nme</span><span class="p">)]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">check_address</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># as there was no match on street name return 0</span>
        <span class="k">return</span> <span class="mi">0</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">check_address</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">1</span>

    <span class="nb">print</span><span class="p">(</span><span class="n">civic_num</span><span class="p">,</span> <span class="n">str_nme</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">check_address</span><span class="p">)</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">parcel_location_flag_builder</span><span class="p">(</span><span class="n">address_row</span><span class="p">,</span> <span class="n">parcel_row</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Compares the address data for address points against linked parcels (if available). A full, partial, or false match is determined and a flag of the correct type is</span>
<span class="sd">    placed on the record.</span>

<span class="sd">    outputs the following flags:</span>

<span class="sd">    0 - Address point and parcel address match do not match</span>
<span class="sd">    1 - Address point and parcel address match</span>
<span class="sd">    -1 - Underlying parcel issue (either no underlying parcel or no valid underlying address)</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="c1"># For cases where there are no underlying parcel but should be filtered out before being put through this function</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parcel_row</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>

    <span class="n">a_list</span> <span class="o">=</span> <span class="n">address_row</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">p_list</span> <span class="o">=</span> <span class="n">parcel_row</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

    <span class="c1"># if cadastral data has no civic number then we return cad_ncn as no accuracy comparison can ba made</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p_list</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span> <span class="c1"># cadastral data no civic number</span>

    <span class="c1"># parcel (cadastral) and address point address part values in simple vars</span>
    <span class="n">adp_civic</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">a_list</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">cad_min</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">p_list</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">cad_max</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">p_list</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">adp_sname</span> <span class="o">=</span> <span class="n">a_list</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">cad_sname</span> <span class="o">=</span> <span class="n">p_list</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
    <span class="c1"># adp_stype = a_list[-1]</span>
    <span class="c1"># cad_stype = p_list[-1]</span>

    <span class="c1"># Setup flag vars as false</span>
    <span class="n">flag_count</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">adp_civic</span> <span class="o">&gt;=</span> <span class="n">cad_min</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">adp_civic</span> <span class="o">&lt;=</span> <span class="n">cad_max</span><span class="p">):</span>
        <span class="n">flag_count</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">adp_sname</span> <span class="o">==</span> <span class="n">cad_sname</span><span class="p">:</span>
        <span class="n">flag_count</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="n">flag_count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">flag_count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>

    <span class="nb">print</span><span class="p">(</span><span class="n">parcel_row</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">address_row</span><span class="p">)</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">confidence_score_calculator</span><span class="p">(</span><span class="n">parcel_rel</span><span class="p">,</span> <span class="n">mun_civ_flag</span><span class="p">,</span> <span class="n">parcel_loc_flag</span><span class="p">,</span> <span class="n">link_len</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">nar_link</span><span class="p">,</span> <span class="n">sbgr_link</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Returns a match confidence score based on key fields calculated during the matching process. Use only as part of an apply function on a single record&#39;&#39;&#39;</span>
    <span class="n">parcel_rel_scores</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;one_to_one&#39;</span> <span class="p">:</span> <span class="mi">60</span><span class="p">,</span>
                        <span class="s1">&#39;one_to_many&#39;</span> <span class="p">:</span> <span class="mi">55</span><span class="p">,</span>
                        <span class="s1">&#39;many_to_one&#39;</span> <span class="p">:</span> <span class="mi">50</span><span class="p">,</span>
                        <span class="s1">&#39;many_to_many&#39;</span> <span class="p">:</span> <span class="mi">40</span><span class="p">,</span>
                        <span class="s1">&#39;unlinked&#39;</span> <span class="p">:</span> <span class="mi">30</span><span class="p">,</span>
                        <span class="s1">&#39;manual&#39;</span> <span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
                        <span class="s1">&#39;other&#39;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">}</span>

    <span class="n">method_scores</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;intersect&#39;</span> <span class="p">:</span> <span class="mi">7</span><span class="p">,</span>
        <span class="s1">&#39;data_linking&#39;</span> <span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
        <span class="s1">&#39;20m_buffer&#39;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s1">&#39;20m_buffer_bp&#39;</span> <span class="p">:</span> <span class="mi">0</span>
    <span class="p">}</span>

    <span class="n">confidence</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># initial calculation based on the parcel relationship</span>
    <span class="k">if</span> <span class="n">parcel_rel</span> <span class="ow">in</span> <span class="n">parcel_rel_scores</span><span class="p">:</span>
        <span class="n">confidence</span> <span class="o">+=</span> <span class="n">parcel_rel_scores</span><span class="p">[</span><span class="n">parcel_rel</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">confidence</span> <span class="o">+=</span> <span class="n">parcel_rel_scores</span><span class="p">[</span><span class="s1">&#39;other&#39;</span><span class="p">]</span>

    <span class="c1"># MODIFIER #1: Secondary Address Sources (municipal civic, NAR, parcel location)</span>
    <span class="k">if</span> <span class="n">mun_civ_flag</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">confidence</span> <span class="o">+=</span> <span class="mi">5</span>
    <span class="c1"># Commented out until new solution is found</span>
    <span class="c1"># if parcel_loc_flag == 1:</span>
    <span class="c1">#     confidence += 5</span>

    <span class="c1"># MODIFIER #2 Link Distance</span>
    <span class="k">if</span> <span class="n">link_len</span> <span class="o">&lt;=</span> <span class="mi">5</span><span class="p">:</span>
        <span class="n">confidence</span> <span class="o">+=</span> <span class="mi">10</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">link_len</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">link_len</span> <span class="o">&lt;=</span> <span class="mi">20</span><span class="p">):</span>
        <span class="n">confidence</span> <span class="o">+=</span> <span class="mi">5</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">link_len</span> <span class="o">&gt;</span> <span class="mi">20</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">link_len</span> <span class="o">&lt;=</span> <span class="mi">50</span><span class="p">):</span>
        <span class="n">confidence</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">link_len</span> <span class="o">&gt;</span> <span class="mi">50</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">link_len</span> <span class="o">&lt;=</span> <span class="mi">200</span><span class="p">):</span> <span class="c1"># Here just to visualize the category. Doesn&#39;t change score</span>
        <span class="n">confidence</span> <span class="o">+=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">link_len</span> <span class="o">&gt;</span> <span class="mi">200</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">link_len</span> <span class="o">&lt;=</span> <span class="mi">400</span><span class="p">):</span> <span class="c1"># Score reduction starts here</span>
        <span class="n">confidence</span> <span class="o">-=</span> <span class="mi">10</span>

    <span class="c1"># MODIFIER #3: NAR and SBgR Linkages</span>
    <span class="k">if</span> <span class="n">nar_link</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">confidence</span> <span class="o">+=</span> <span class="mi">10</span>
    <span class="k">if</span> <span class="n">sbgr_link</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">confidence</span> <span class="o">+=</span> <span class="mi">5</span>

    <span class="c1"># MODIFIER #4: Link Method</span>
    <span class="k">if</span> <span class="n">method</span> <span class="ow">in</span> <span class="n">method_scores</span><span class="p">:</span>
        <span class="n">confidence</span> <span class="o">+=</span> <span class="n">method_scores</span><span class="p">[</span><span class="n">method</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">confidence</span> <span class="o">+=</span> <span class="mi">0</span>

    <span class="k">return</span> <span class="n">confidence</span>


<span class="k">def</span> <span class="nf">valid_confidence_input_counter</span><span class="p">(</span><span class="n">mun_civ_flag</span><span class="p">,</span> <span class="n">parcel_loc_flag</span><span class="p">,</span> <span class="n">link_len</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">nar_link</span><span class="p">,</span> <span class="n">sbgr_link</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Returns the number of valid modifiers on the parcel relationship score that were used to help calculate the confidence value.</span>
<span class="sd">    Parcel relationship is not included in this calculation.&#39;&#39;&#39;</span>

    <span class="n">v_score</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1"># For preflagged modifiers check for the match flag</span>
    <span class="k">for</span> <span class="n">mod</span> <span class="ow">in</span> <span class="p">[</span><span class="n">mun_civ_flag</span><span class="p">,</span> <span class="n">nar_link</span><span class="p">,</span> <span class="n">sbgr_link</span><span class="p">]:</span> <span class="c1">#parcel_loc_flag]:</span>
        <span class="k">if</span> <span class="n">mod</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">v_score</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="c1"># Specific checks for other flags</span>

    <span class="c1"># For link len check that the link len is within the lowest positive scoring distance (&lt;50)</span>
    <span class="k">if</span> <span class="n">link_len</span> <span class="o">&lt;</span> <span class="mi">50</span><span class="p">:</span>
        <span class="n">v_score</span> <span class="o">+=</span><span class="mi">1</span>

    <span class="c1"># For method add only methods that contribute to a positive score</span>
    <span class="k">if</span> <span class="n">method</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;intersect&#39;</span><span class="p">,</span> <span class="s1">&#39;data_linking&#39;</span><span class="p">]:</span>
        <span class="n">v_score</span> <span class="o">+=</span><span class="mi">1</span>
    <span class="c1"># Add other specific modifiers here if they become available</span>

    <span class="k">return</span> <span class="n">v_score</span>


<span class="k">def</span> <span class="nf">total_confidence_input_counter</span><span class="p">(</span><span class="n">mun_civ_flag</span><span class="p">,</span> <span class="n">parcel_loc_flag</span><span class="p">,</span> <span class="n">link_len</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">nar_link</span><span class="p">,</span> <span class="n">sbgr_link</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Returns the total number of confidence modifiers that had a valid input (</span>
<span class="sd">        modifiers with an invalid input -1 or NULL are excluded from this calculation)&#39;&#39;&#39;</span>

    <span class="n">i_score</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># For preflagged modifiers check if the record doesn&#39;t equal the invalid flag</span>
    <span class="k">for</span> <span class="n">mod</span> <span class="ow">in</span> <span class="p">[</span><span class="n">mun_civ_flag</span><span class="p">,</span> <span class="n">nar_link</span><span class="p">,</span> <span class="n">sbgr_link</span><span class="p">]:</span><span class="c1"># parcel_loc_flag]:</span>
        <span class="k">if</span> <span class="n">mod</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">i_score</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="c1"># If score is between 0 and 50 take as a positive indicator (50 being the lowest positive category)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">link_len</span> <span class="o">&gt;=</span> <span class="mf">0.0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">link_len</span> <span class="o">&lt;=</span> <span class="mf">50.0</span><span class="p">):</span>
        <span class="n">i_score</span> <span class="o">+=</span><span class="mi">1</span>

    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">method</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">i_score</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">return</span> <span class="n">i_score</span>


<span class="k">def</span> <span class="nf">determine_confidence_type</span><span class="p">(</span><span class="n">con_score</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Returns a string denoting the level of confidence in the match based on the integer value of a given input field (usually &#39;confidence&#39;)&#39;&#39;&#39;</span>

    <span class="k">if</span> <span class="n">con_score</span> <span class="o">&gt;=</span> <span class="mi">70</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;HIGH&#39;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">con_score</span> <span class="o">&gt;=</span> <span class="mi">60</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">con_score</span> <span class="o">&lt;</span> <span class="mi">70</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;MEDIUM&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;LOW&#39;</span>

    <span class="n">addresses</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">qa_qc_gpkg</span><span class="p">,</span> <span class="n">layer</span><span class="o">=</span><span class="n">addresses_lyr_nme</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="n">proj_crs</span><span class="p">)</span>

    <span class="n">parcels</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">project_gpkg</span><span class="p">,</span> <span class="n">layer</span><span class="o">=</span><span class="n">parcel_lyr_nme</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="n">proj_crs</span><span class="p">)</span>

    <span class="c1"># Create flags for secondary address sources</span>

    <span class="k">if</span> <span class="n">mun_civic_lyr_nme</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">fiona</span><span class="o">.</span><span class="n">listlayers</span><span class="p">(</span><span class="n">mun_civic_gpkg</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;No municipal civics data available&#39;</span><span class="p">)</span>
        <span class="n">addresses</span><span class="p">[</span><span class="s1">&#39;mun_civic_flag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">NaN</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">mun_civics</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">mun_civic_gpkg</span><span class="p">,</span> <span class="n">layer</span><span class="o">=</span><span class="n">mun_civic_lyr_nme</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="n">proj_crs</span><span class="p">,</span> <span class="n">driver</span><span class="o">=</span><span class="s1">&#39;GPKG&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Prepping municipal civic fields&#39;</span><span class="p">)</span>
        <span class="n">mun_civics</span><span class="p">[</span><span class="s1">&#39;st_nme&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mun_civics</span><span class="p">[</span><span class="s1">&#39;st_nme&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Creating municipal civics flag&#39;</span><span class="p">)</span>
        <span class="n">addresses</span><span class="p">[</span><span class="s1">&#39;mun_civic_flag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">addresses</span><span class="p">[[</span><span class="s1">&#39;link_field&#39;</span><span class="p">,</span> <span class="s1">&#39;number&#39;</span><span class="p">,</span> <span class="s1">&#39;street&#39;</span><span class="p">,</span> <span class="s1">&#39;stype_en&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">civics_flag_builder</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">row</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="n">mun_civics</span><span class="p">[</span><span class="n">mun_civics</span><span class="p">[</span><span class="s1">&#39;link_field&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">addresses</span><span class="p">[</span><span class="s1">&#39;parcel_loc_flag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">NaN</span>

    <span class="k">if</span> <span class="s1">&#39;nar_addr_guid&#39;</span> <span class="ow">in</span> <span class="n">addresses</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">():</span>
        <span class="n">addresses</span><span class="p">[</span><span class="s1">&#39;nar_link_flag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">addresses</span><span class="p">[</span><span class="s1">&#39;nar_addr_guid&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">1</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">addresses</span><span class="p">[</span><span class="s1">&#39;nar_link_flag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">NaN</span>

    <span class="k">if</span> <span class="s1">&#39;sbgr_bg_sn&#39;</span> <span class="ow">in</span> <span class="n">addresses</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">():</span>
        <span class="n">addresses</span><span class="p">[</span><span class="s1">&#39;sbgr_link_flag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">addresses</span><span class="p">[</span><span class="s1">&#39;sbgr_bg_sn&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">1</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">addresses</span><span class="p">[</span><span class="s1">&#39;sbgr_link_flag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">NaN</span>

<span class="c1"># Calculate confidence score and associated fields</span>
<span class="n">confidence_vars</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;parcel_rel&#39;</span><span class="p">,</span> <span class="s1">&#39;mun_civic_flag&#39;</span><span class="p">,</span> <span class="s1">&#39;parcel_loc_flag&#39;</span><span class="p">,</span> <span class="s1">&#39;link_length&#39;</span><span class="p">,</span> <span class="s1">&#39;method&#39;</span><span class="p">,</span> <span class="s1">&#39;nar_link_flag&#39;</span><span class="p">,</span> <span class="s1">&#39;sbgr_link_flag&#39;</span><span class="p">]</span>

<span class="n">addresses</span><span class="p">[</span><span class="s1">&#39;confidence&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">addresses</span><span class="p">[</span><span class="n">confidence_vars</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">confidence_score_calculator</span><span class="p">(</span><span class="o">*</span><span class="n">row</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">addresses</span><span class="p">[</span><span class="s1">&#39;con_valid_inputs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">addresses</span><span class="p">[</span><span class="n">confidence_vars</span><span class="p">[</span><span class="mi">1</span><span class="p">:]]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">valid_confidence_input_counter</span><span class="p">(</span><span class="o">*</span><span class="n">row</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">addresses</span><span class="p">[</span><span class="s1">&#39;con_total_inputs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">addresses</span><span class="p">[</span><span class="n">confidence_vars</span><span class="p">[</span><span class="mi">1</span><span class="p">:]]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">total_confidence_input_counter</span><span class="p">(</span><span class="o">*</span><span class="n">row</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">addresses</span><span class="p">[</span><span class="s1">&#39;confidence_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">addresses</span><span class="p">[</span><span class="s1">&#39;confidence&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">c</span><span class="p">:</span> <span class="n">determine_confidence_type</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>

<span class="c1"># Add confidence to line links</span>
<span class="n">lines_gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">qa_qc_gpkg</span><span class="p">,</span> <span class="n">layer</span><span class="o">=</span><span class="n">line_link_lyr_nme</span><span class="p">)</span>
<span class="n">lines_gdf</span> <span class="o">=</span> <span class="n">lines_gdf</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">addresses</span><span class="p">[[</span><span class="s1">&#39;link_id&#39;</span><span class="p">,</span> <span class="s1">&#39;confidence&#39;</span><span class="p">,</span> <span class="s1">&#39;confidence_type&#39;</span><span class="p">]],</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;link_id&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>


            </article>
            
            
            
            <footer class="bd-footer-article">
                <!-- Previous / next buttons -->
<div class='prev-next-area'>
  <a class='left-prev' id="prev-link" href="qa_qc.html" title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
          <p class="prev-next-subtitle">previous</p>
          <p class="prev-next-title">Step 4: Match QA/QC</p>
      </div>
  </a>
  <a class='right-next' id="next-link" href="../polygon_cutting.html" title="next page">
  <div class="prev-next-info">
      <p class="prev-next-subtitle">next</p>
      <p class="prev-next-title">Polygon Splitting</p>
  </div>
  <i class="fa-solid fa-angle-right"></i>
  </a>
</div>
            </footer>
            
          </div>
          
          
          
            <div class="bd-sidebar-secondary bd-toc">
              
<div class="toc-item">
  
<div class="tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
</div>
<nav id="bd-toc-nav" class="page-toc">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#base-scores">
   Base Scores
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#match-method">
   Match Method
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#link-distance">
   Link Distance
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#other-secondary-sources">
   Other Secondary Sources
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#final-classification">
   Final Classification
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#method">
   Method
  </a>
 </li>
</ul>

</nav>
</div>

<div class="toc-item">
  
<div id="searchbox"></div>
</div>

<div class="toc-item">
  
</div>

<div class="toc-item">
  
<div class="tocsection sourcelink">
    <a href="../_sources/address_matching/confidence.rst.txt">
        <i class="fa-solid fa-file-lines"></i> Show Source
    </a>
</div>

</div>

            </div>
          
          
        </div>
        <footer class="bd-footer-content">
          <div class="bd-footer-content__inner">
            
          </div>
        </footer>
        
      </main>
    </div>
  </div>

  
    
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=796348d33e8b1d947c94"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=796348d33e8b1d947c94"></script>

  <footer class="bd-footer"><div class="bd-footer__inner container">
  
  <div class="footer-item">
    
<p class="copyright">

    &copy; Copyright 2023, Statistics Canada.<br>

</p>

  </div>
  
  <div class="footer-item">
    <p class="theme-version">
    Built with the
    <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">
        PyData Sphinx Theme
    </a>
    0.12.0.
</p>
  </div>
  
  <div class="footer-item">
    
<p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 5.3.0.<br>
</p>

  </div>
  
</div>
  </footer>
  </body>
</html>